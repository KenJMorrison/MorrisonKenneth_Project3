<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>Project 3</title>
    <style>
	* { 
		padding: 0; 
		margin: 0; 
	} 
	canvas { 
		background: #000; 
		display: block; 
		margin: 0 auto; 
	}
	</style>
</head>
<body>

<canvas id='myCanvas' width='640' height='480'></canvas>

<script>
    var canvas = document.getElementById('myCanvas');
    var context = canvas.getContext('2d');
	var ball = {
		'radius': 15,
		'x': canvas.width/2,
		'y': canvas.height-30,
		'dx': 2,
		'dy': -2
	}
	var paddle = {
		'height': 20,
		'width': 100,
		'x': (canvas.width-this.width)/2
	}
    var rightPressed = false;
    var leftPressed = false;
    var brickRowCount = 7;
    var brickColumnCount = 4;
    var brickWidth = 75;
    var brickHeight = 20;
    var brickPadding = 10;
    var brickOffsetTop = 30;
    var brickOffsetLeft = 30;
    var score = 0;
    var bricks = [];
	 var timer;

    for(var c=0; c<brickColumnCount; c++) {
        bricks[c] = [];
        for(var r=0; r<brickRowCount; r++) {
            bricks[c][r] = { x: 0, y: 0, status: 1 };
        }
    }
    document.addEventListener('keydown', keyDownHandler, false);
    document.addEventListener('keyup', keyUpHandler, false);
    document.addEventListener('mousemove', mouseMoveHandler, false);
    function keyDownHandler(e) {
        if(e.keyCode == 39) {
            rightPressed = true;
        }
        else if(e.keyCode == 37) {
            leftPressed = true;
        }
    }
    function keyUpHandler(e) {
        if(e.keyCode == 39) {
            rightPressed = false;
        }
        else if(e.keyCode == 37) {
            leftPressed = false;
        }
    }
    function mouseMoveHandler(e) {
        var relativeX = e.clientX - canvas.offsetLeft;
        if(relativeX > 0 && relativeX < canvas.width) {
            paddle.x = relativeX - paddle.width/2;
        }
    }
    function collisionDetection() {
        for(c=0; c<brickColumnCount; c++) {
            for(r=0; r<brickRowCount; r++) {
                var b = bricks[c][r];
                if(b.status == 1) {
                    if(ball.x > b.x && ball.x < b.x+brickWidth && ball.y > b.y && ball.y < b.y+brickHeight) {
                        ball.dy = -ball.dy;
                        b.status = 0;
                        score++;
                        if(score == brickRowCount*brickColumnCount) {
                            alert('YOU WIN, CONGRATS!');
                            document.location.reload();
                        }
                    }
                }
            }
        }
    }
    function drawBall() { // I'm trying to make the ball have a 'trail' but I'm trying and I'm not sure how it was done.
        context.beginPath();
        context.arc(ball.x, ball.y, ball.radius, 0, Math.PI*2);
        context.fillStyle = '#00efe6';
        context.fill();
		context.globalCompositeOperation = "source-over";
		context.fillStyle = "rgba(0, 0, 0, 0.3)";
		context.fillRect(0, 0, canvas.width, canvas.height);
		context.globalCompositOperation = 'lighter';
		        context.closePath();
			for(var i = 0; i < ball.length; i++){
		var b = ball[i];
		context.beginPath();
		context.arc(b.x, b.y, b.radius, 0, degreesToRadians(360), true);
		context.fillStyle = b.color;
		context.fill();
		
		b.x += b.vx;
		b.y += b.vy;
		
		if(b.x < -50) b.x = canvas.width + 50;
		if(b.y < -50) b.y = canvas.height + 50; 
		if(b.x > canvas.width + 50) b.x = -50;
		if(b.y > canvas.height + 50) b.y = -50;
		}
    }
	

	
	
    function drawPaddle() {
        context.beginPath();
        context.rect(paddle.x, canvas.height-paddle.height, paddle.width, paddle.height);
        context.fillStyle = '#ffffff';
        context.fill();
        context.closePath();
    }
    function drawBricks() { 
        for(c=0; c<brickColumnCount; c++) {
            for(r=0; r<brickRowCount; r++) {
                if(bricks[c][r].status == 1) {
                    var brickX = (r*(brickWidth+brickPadding))+brickOffsetLeft;
                    var brickY = (c*(brickHeight+brickPadding))+brickOffsetTop;                 	
					var colors = ["#ff9900", "#ff471a", "#e6005c", "#ffff00", "#ffffff"];
					var color = colors[Math.floor(Math.random()*colors.length)];
                    bricks[c][r].x = brickX;
                    bricks[c][r].y = brickY;
                    context.beginPath();
                    context.rect(brickX, brickY, brickWidth, brickHeight);
					context.fillStyle = color;
					context.fill();
                    context.closePath();
                }
            }
        }
    }
    function drawScore() {
        context.font = '20px Arial';
        context.fillStyle = '#ffffff';
        context.fillText('Score: '+score, 320, 20);
		context.textAlign = 'center'
    }
    function draw() {
        context.clearRect(0, 0, canvas.width, canvas.height);
        drawBricks();
        drawBall();
        drawPaddle();
        drawScore();
        collisionDetection();
        if(ball.x + ball.dx > canvas.width-ball.radius || ball.x + ball.dx < ball.radius) {
            ball.dx = -ball.dx;
        }
        if(ball.y + ball.dy < ball.radius) {
            ball.dy = -ball.dy;
        }
        else if(ball.y + ball.dy > canvas.height-ball.radius) {
            if(ball.x > paddle.x && ball.x < paddle.x + paddle.width) {
                ball.dy = -ball.dy;
            }
            else {
                alert('GAME OVER');
                document.location.reload();
            }
        }
        if(rightPressed && paddle.x < canvas.width-paddle.width) {
            paddle.x += 7;
        }
        else if(leftPressed && paddle.x > 0) {
            paddle.x -= 7;
        }
        ball.x += ball.dx;
        ball.y += ball.dy;
    }
	

    setInterval(draw, 10);
	timer = setInterval(drawBall, 5);
</script>

</body>
</html>